@if (visible()) {
<div class="dialog-overlay" (click)="cancel()">
  <div class="dialog-content" (click)="$event.stopPropagation()">
    <div class="dialog-header">
      <h2 class="text-xl font-bold text-white">{{ 'SETTINGS.TITLE' | translate }}</h2>
      <button class="close-btn material-icons" (click)="cancel()">close</button>
    </div>

    <div class="dialog-body">
      <div class="section">
        <h3 class="section-title">{{ 'SETTINGS.GAME_SETTINGS' | translate }}</h3>
        <div class="player-config">
          <div class="config-row">
            <label>{{ 'SETTINGS.WHITE_PLAYER' | translate }}:</label>
            <div class="toggle-group">
              <button
                class="toggle-btn"
                [class.active]="selectedWhitePlayerType === 'human'"
                (click)="selectedWhitePlayerType = 'human'"
              >
                {{ 'SETTINGS.HUMAN' | translate }}
              </button>
              <button
                class="toggle-btn"
                [class.active]="selectedWhitePlayerType === 'computer'"
                (click)="selectedWhitePlayerType = 'computer'"
              >
                {{ 'SETTINGS.COMPUTER' | translate }}
              </button>
            </div>
          </div>
          <div class="config-row">
            <label>{{ 'SETTINGS.BLACK_PLAYER' | translate }}:</label>
            <div class="toggle-group">
              <button
                class="toggle-btn"
                [class.active]="selectedBlackPlayerType === 'human'"
                (click)="selectedBlackPlayerType = 'human'"
              >
                {{ 'SETTINGS.HUMAN' | translate }}
              </button>
              <button
                class="toggle-btn"
                [class.active]="selectedBlackPlayerType === 'computer'"
                (click)="selectedBlackPlayerType = 'computer'"
              >
                {{ 'SETTINGS.COMPUTER' | translate }}
              </button>
            </div>
          </div>

          <!-- White Player ELO -->
          @if (selectedWhitePlayerType === 'computer') {
          <div class="config-row elo-config">
            <div class="elo-header">
              <label>{{ 'SETTINGS.WHITE_ELO' | translate }}:</label>
              <span class="elo-value">{{ selectedWhiteComputerElo }}</span>
            </div>
            <input
              type="range"
              min="1350"
              max="2850"
              step="50"
              [(ngModel)]="selectedWhiteComputerElo"
              class="elo-slider"
            />
            <div class="elo-labels">
              <span>{{ 'SETTINGS.BEGINNER' | translate }}</span>
              <span>{{ 'SETTINGS.GRANDMASTER' | translate }}</span>
            </div>
          </div>
          }

          <!-- Black Player ELO -->
          @if (selectedBlackPlayerType === 'computer') {
          <div class="config-row elo-config">
            <div class="elo-header">
              <label>{{ 'SETTINGS.BLACK_ELO' | translate }}:</label>
              <span class="elo-value">{{ selectedBlackComputerElo }}</span>
            </div>
            <input
              type="range"
              min="1350"
              max="2850"
              step="50"
              [(ngModel)]="selectedBlackComputerElo"
              class="elo-slider"
            />
            <div class="elo-labels">
              <span>{{ 'SETTINGS.BEGINNER' | translate }}</span>
              <span>{{ 'SETTINGS.GRANDMASTER' | translate }}</span>
            </div>
          </div>
          }
        </div>
      </div>

      <div class="section">
        <h3 class="section-title">{{ 'SETTINGS.LANGUAGE' | translate }}</h3>
        <div class="options-grid">
          @for (lang of languages; track lang.code) {
          <button
            class="option-btn"
            [class.active]="selectedLanguage === lang.code"
            (click)="changeLanguage(lang.code)"
            [title]="lang.name"
          >
            <span style="font-size: 2.5rem; line-height: 1.2">{{ lang.flag }}</span>
          </button>
          }
        </div>
      </div>

      <div class="section">
        <h3 class="section-title">{{ 'SETTINGS.APP_THEME' | translate }}</h3>
        <div class="options-grid">
          @for (theme of appThemes; track theme.id) {
          <button
            class="option-btn"
            [class.active]="selectedAppTheme === theme.id"
            (click)="selectAppTheme(theme.id)"
          >
            <div class="preview-theme" [class]="'theme-' + theme.id"></div>
            <span>{{ theme.name | translate }}</span>
          </button>
          }
        </div>
      </div>

      <div class="section">
        <h3 class="section-title">{{ 'SETTINGS.PIECE_SET' | translate }}</h3>
        <div class="options-grid">
          @for (theme of pieceThemes; track theme.id) {
          <button
            class="option-btn"
            [class.active]="selectedPieceTheme === theme.id"
            (click)="selectedPieceTheme = theme.id"
          >
            <div class="preview-piece">
              <img [src]="getPiecePreviewUrl(theme.id)" alt="Knight" />
            </div>
            <span class="theme-name">{{ theme.name }}</span>
          </button>
          }
        </div>
      </div>
    </div>

    <div class="dialog-footer">
      <button class="btn btn-secondary" (click)="cancel()">
        {{ 'SETTINGS.CANCEL' | translate }}
      </button>
      <button class="btn btn-primary" (click)="save()">{{ 'SETTINGS.SAVE' | translate }}</button>
    </div>
  </div>
</div>
}
